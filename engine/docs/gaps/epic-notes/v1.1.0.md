# Epic v1.1.0: Hygiene

**Status:** ğŸš§ In Progress
**Branch:** v1.1.0
**Started:** 2026-01-26
**Completed:** _In progress_

---

## Goal

Repository structure and code hygiene improvements for long-term maintainability. This epic combines two cleanup tasks:

1. **Folder Reorganization:** Move all folders except `books/` into `engine/`
2. **Hidden Object Files:** Update scripts to use hidden filenames (`.faiss.index`, `.chunks.json`, `.chunks.pkl`)

**Why merge these:**
- Both are hygiene/housekeeping tasks
- Both require coordinated path updates across multiple scripts
- Both improve user experience (cleaner workspace, no clutter)
- Can be tested and released together

---

## What We're Building

### Current Structure

```
librarian/
  books/              â† User content (stays at root)
  models/             â† Move to engine/
  scripts/            â† Move to engine/
  .github/            â† Stays at root (Git convention)
  .vscode/            â† Stays at root (VS Code convention)
  README.md           â† Stays at root
  requirements.txt    â† Move to engine/
  project.code-workspace â† Stays at root
```

### Target Structure

```
librarian/
  books/              â† User content (ONLY thing at root besides config)
  engine/             â† Everything else
    models/
    scripts/
    docs/
    requirements.txt
  .github/            â† Git config (stays)
  .vscode/            â† VS Code config (stays)
  README.md           â† Entry point (stays)
  project.code-workspace â† Workspace config (stays)
```

### Hidden Object Files

**Current:**
```
books/AI/policy/
  chunks.json         â† Visible clutter
  faiss.index         â† Visible clutter
  topic-index.json    â† User metadata (stays visible)
  book1.epub          â† User content
```

**Target:**
```
books/AI/policy/
  topic-index.json    â† User metadata (stays visible)
  .chunks.json        â† Hidden (implementation detail)
  .faiss.index        â† Hidden (implementation detail)
  book1.epub          â† User content
```

**Rationale:** 
- Object files (chunks, indices) are implementation details â†’ hide them
- Metadata (topic-index.json) is user-relevant â†’ keep visible
- Less clutter in user's file browser

---

## Tasks

### Part 1: Folder Reorganization

- [ ] Create `engine/` directory structure
- [ ] Move `models/` â†’ `engine/models/`
- [ ] Move `scripts/` â†’ `engine/scripts/`
- [ ] Move `requirements.txt` â†’ `engine/requirements.txt`
- [ ] Confirm `engine/docs/` already exists (it does)
- [ ] Update all script imports and path references
- [ ] Update README.md installation instructions
- [ ] Update .gitignore paths if needed
- [ ] Update tasks.json paths
- [ ] Test all scripts work with new paths

### Part 2: Hidden Object Files

- [ ] Update `indexer_v2.py` to write `.chunks.json` (hidden)
- [ ] Update `indexer_v2.py` to write `.faiss.index` (hidden)
- [ ] Update `research.py` to read from hidden files
- [ ] Update `mcp_server.py` to read from hidden files
- [ ] Update any other scripts that reference object files
- [ ] Add migration script to rename existing files (optional helper)
- [ ] Update CHECKS.md tests for new filenames
- [ ] Test on macOS (hidden files work)
- [ ] Document in README/CHANGELOG

### Part 3: Validation

- [ ] All stability checks pass (run from CHECKS.md)
- [ ] Research queries work (`python3.11 engine/scripts/research.py "test" --topic ai`)
- [ ] Indexing works (`python3.11 engine/scripts/indexer_v2.py --topic cooking`)
- [ ] MCP server starts successfully
- [ ] Document breaking changes for existing users
- [ ] Update migration guide

---

## Notes

### Previous Attempt Context

From ROADMAP note:
> ğŸ—’ï¸ Previous attempts failed due to path/test breakageâ€”requires careful, coordinated update.

**Lessons learned:**
- Don't rush path updates
- Update imports before moving files
- Test incrementally (one folder at a time)
- Document each breaking change

### Migration Strategy

**For existing users:**
1. Pull latest changes
2. Run migration script (if provided) OR manually rename files
3. Re-run setup if needed
4. Verify with stability checks

**Non-breaking approach:**
- Scripts should check for both old and new paths (fallback)
- Warn if old paths detected
- Gradually deprecate old paths in future version

---

## Session Log

### Session 1: 2026-01-26

**Setup:**
- Committed workspace title change on main
- Created v1.1.0 branch
- Updated ROADMAP epic status (â³ â†’ ğŸš§)
- Created this epic notes file

**Next:**
- Begin Part 1: Folder reorganization
- Start with creating engine/ structure and moving one folder at a time

---

**Last updated:** 2026-01-26
