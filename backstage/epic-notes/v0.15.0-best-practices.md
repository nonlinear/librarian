# Epic Note: Best Practices from Official Skills

**Created:** 2026-02-08  
**Epic:** v0.15.0-skill-enforcement  
**Goal:** Learn from proven skills, extract patterns, compare with our approach

---

## Skills Analyzed

1. **weather** - Simple, no deps, pure docs
2. **github** - Wrapper around `gh` CLI
3. **imsg** - Wrapper around `imsg` CLI
4. **peekaboo** - Complex CLI wrapper, detailed docs
5. **summarize** - Wrapper with trigger phrases
6. **apple-notes** - Simple wrapper around `memo` CLI

---

## Pattern 1: SKILL.md Structure

**All skills follow same structure:**

```markdown
---
name: skill-name
description: One-line description (used in trigger detection)
homepage: https://link-to-docs (optional)
metadata: {...} (emoji, requires, install, os)
---

# Skill Name

Brief intro.

## When to use (OPTIONAL - only some skills)
- Trigger phrases
- Use cases

## Quick start
```bash
actual command
```

## Common patterns/flags
- Feature 1
- Feature 2

## Examples
```

**Key insights:**
- ‚úÖ SKILL.md = pure documentation (no protocol enforcement)
- ‚úÖ Frontmatter metadata = requirements, deps, install
- ‚úÖ Trigger phrases = explicitly listed (when needed)
- ‚úÖ Examples = real, copy-pasteable commands
- ‚ùå NO enforcement logic in SKILL.md

---

## Pattern 2: CLI-First, No Wrappers

**Almost all skills are THIN wrappers:**

| Skill | Underlying Tool | Wrapper Complexity |
|-------|----------------|-------------------|
| weather | `curl` + wttr.in | NONE (just docs) |
| github | `gh` CLI | NONE (just docs) |
| imsg | `imsg` CLI | NONE (just docs) |
| peekaboo | `peekaboo` CLI | NONE (just docs) |
| summarize | `summarize` CLI | NONE (just docs) |
| apple-notes | `memo` CLI | NONE (just docs) |

**Insight:**
- ‚úÖ Skills document existing CLIs
- ‚úÖ NO shell script wrappers in official skills
- ‚úÖ Trust the underlying tool to handle errors
- ‚ùå Our librarian.sh = NEW pattern (enforcement wrapper)

**Why our case is different:**
- Research.py returns JSON (needs formatting)
- Empty results = valid JSON (LLM can invent if unchecked)
- We need **guarantee** of "n√£o achei" vs invention

**Conclusion:** Shell wrapper justified ONLY when:
1. Underlying tool returns ambiguous output (JSON with empty array)
2. LLM can misinterpret empty as "permission to invent"
3. Wrapper enforces binary behavior (found vs not found)

---

## Pattern 3: Trigger Phrases (When Listed)

**Only summarize.sh explicitly lists triggers:**

```markdown
## When to use (trigger phrases)

Use this skill immediately when the user asks any of:
- "use summarize.sh"
- "what's this link/video about?"
- "summarize this URL/article"
- "transcribe this YouTube/video"
```

**Our librarian triggers (from AGENTS.md):**
- "pesquisa" / "search" / "procura" + book/topic
- "tarot" / "I Ching" / "book"

**Insight:**
- ‚úÖ Explicit trigger list = clear contract
- ‚úÖ Lives in AGENTS.md (user-editable)
- ‚ùå SKILL.md doesn't repeat triggers (DRY principle)

**Our approach:** Keep triggers in AGENTS.md, reference in SKILL.md

---

## Pattern 4: Error Handling

**How official skills handle errors:**

1. **weather** - Relies on `curl` exit codes
2. **github** - Relies on `gh` CLI errors
3. **imsg** - Documents permission requirements, no wrapper
4. **peekaboo** - Detailed permission docs, CLI handles errors
5. **summarize** - API key errors shown by CLI

**Insight:**
- ‚úÖ Trust CLI to fail loudly
- ‚úÖ Document permission requirements up front
- ‚ùå No wrapper scripts to "improve" errors

**Our case:**
- Research.py fails silently (empty JSON = valid)
- Wrapper needed to detect "no results" vs "error"
- Wrapper provides actionable error (reindex instructions)

**Conclusion:** Wrapper justified for **silent failures only**

---

## Pattern 5: Metadata (Frontmatter)

**All skills declare:**
- `emoji` - Visual identity
- `requires.bins` - CLI dependencies
- `install` - How to install missing deps
- `os` - Platform restrictions (darwin, linux)

**Our librarian metadata (should have):**
```yaml
metadata:
  openclaw:
    emoji: üìö
    os: ["darwin", "linux"]
    requires:
      bins: ["python3", "jq"]
      python: ["sentence-transformers", "torch"]
    install:
      - kind: pip
        package: sentence-transformers
        label: Install ML dependencies
```

**Insight:**
- ‚úÖ Metadata = declarative requirements
- ‚úÖ OpenClaw can auto-check deps
- ‚ùå We didn't add this yet (next epic)

---

## Pattern 6: Documentation Density

**Skills are DENSE with examples:**

- **peekaboo:** 200+ lines, every feature documented
- **summarize:** Trigger phrases, model config, flags, examples
- **github:** Common workflows (PR checks, CI logs, API queries)

**Our librarian SKILL.md (current):**
- Verbose protocol instructions (should be in wrapper)
- Sparse examples (should add more)
- Missing common workflows (research by author, date, etc.)

**Insight:**
- ‚úÖ SKILL.md = user reference (examples, flags, workflows)
- ‚ùå Protocol enforcement ‚â† documentation
- ‚úÖ Move protocol to wrapper, expand examples

---

## Comparison: Official vs Our Approach

| Aspect | Official Skills | Our Librarian (current) | Our Librarian (proposed) |
|--------|----------------|------------------------|-------------------------|
| **SKILL.md role** | Pure docs, examples | Docs + protocol | Pure docs, examples |
| **Enforcement** | None (trust CLI) | Text rules (ignored) | Shell script (binary) |
| **Error handling** | CLI errors shown | Text says "don't invent" | Script enforces "n√£o achei" |
| **Wrappers** | None (thin docs) | None yet | librarian.sh (justified) |
| **Metadata** | Frontmatter (deps) | Missing | Should add |
| **Triggers** | Listed in SKILL.md | In AGENTS.md | Keep in AGENTS.md |
| **Examples** | Dense, copy-paste | Sparse | Expand |

---

## Recommendations

**‚úÖ Keep (aligned with official patterns):**
1. SKILL.md = documentation only
2. Trigger phrases in AGENTS.md (user-editable)
3. Dense examples in SKILL.md
4. Frontmatter metadata (deps, install)

**üîÑ Change (justified deviations):**
1. Add librarian.sh wrapper (handles silent failures)
2. Move protocol enforcement to script
3. SKILL.md documents wrapper usage, not protocol

**üìã Next Epic (metadata):**
1. Add frontmatter to librarian/SKILL.md
2. Declare python deps (sentence-transformers, torch)
3. Add install instructions for missing deps

**üìã Future Epic (multi-topic, features):**
1. Multi-topic search (after stable)
2. Author/date filters (after usage data)
3. Reindexing automation (after refactor complete)

---

## Key Insight: When to Deviate

**Official skills wrap CLIs that fail loudly.**

**Our case:**
- research.py returns `{"results": []}` (valid JSON)
- LLM interprets empty as "I can guess from knowledge"
- Wrapper detects empty ‚Üí enforces "n√£o achei"

**Deviation justified because:**
1. Silent failure (valid JSON, empty array)
2. LLM misinterpretation (invention risk)
3. Wrapper enforces binary behavior (found vs not found)

**Rule:** Wrapper needed ONLY when underlying tool has **silent failures** that LLM can misinterpret.

---

## Next Steps (this epic)

1. ‚úÖ librarian.sh written (enforcement)
2. [ ] Update SKILL.md (pure docs, reference wrapper)
3. [ ] Test with real data (after Nicholas reindexes)
4. [ ] Add frontmatter metadata (emoji, deps)
5. [ ] Clean up non-critical errors (after tests pass)

**Sandbox all other ideas** (multi-topic, reindex automation, etc.)
