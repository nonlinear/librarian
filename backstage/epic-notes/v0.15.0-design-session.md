# v0.15.0 Design Session - 2026-02-08

## Context
Designing skill protocol architecture diagram for librarian interaction flow.

## Conversation → Diagram Evolution

### 1️⃣ Initial Diagram (d08ae78 - 15:24)
**Input:** "vamos trabalhar no epic 15"
**Output:** Basic flowchart structure created
- Nodes: Trigger → Metadata → Infer → Build → Execute → Response
- No colors yet
- Generic text

### 2️⃣ Color System (d8094af - 15:31)
**Input:** "adiciona cores: yellow = approved, pink = needs discussion"
**Output:** Color legend added
- Yellow (#FFEB3B) = agreement reached
- Pink (#FFB6C1) = pending decisions
- Gray = execution/data flow

### 3️⃣ Curved Nodes + Hard Stop (8c976c1 - 16:06)
**Input:** Multiple clarifications:
- "No metadata found" → What message to show?
- Exit node needed?
- Curve all nodes?
**Output:**
- All nodes curved: `([node])`
- EXIT node removed
- Error: "No metadata found. Run librarian index"
- Added 4️⃣ Hard Stop note (VISION: honesty > helpful lies)

### 4️⃣ Lighter Yellow + Bold (36635dd - 16:11)
**Input:** "yellow, lighter? globally. also everything in bold?"
**Output:**
- Yellow: #FFFF99 (lighter)
- All nodes: font-weight:bold
- CLARIFY → Yellow (approved)
- Added 6️⃣ Ask Clarification defense layer

### 5️⃣ Build Command + Format Output (8fb2176 - 16:13)
**Input:** 
- "1. checa research.py e sugere sintaxe"
- "2. kavita eh uma PARTE de source precision"
- "3. temos sintaxe EXATO em skill e research prompt"
**Output:**
- 3️⃣ Build: Exact syntax documented
  ```bash
  python3 engine/scripts/research.py "QUERY" --topic TOPIC_ID
  ```
- 5️⃣ Format: Current behavior = markdown citations (Kavita future)
- v1.4.0 renamed: "Source Granularity" → "Source Precision"

### 6️⃣ User-Facing Error + Confidence (90ff226 - 16:20)
**Input:**
- "No metadata found seria '⚠️ No metadata found: Run librarian index' em quotes"
- "low confidence vira 'confidence lower than 75%'"
- "Response becomes Librarian response"
- "librarian eh OUTRO familiar. ou, servitor."
**Output:**
- ERROR: `"⚠️ No metadata found: Run librarian index"` (user quote)
- INFER edges: "confidence lower/higher than 75%" (explicit)
- RESPONSE: "Librarian response" (servitor boundary)
- Added 7️⃣ Blueprint Sanity Check

### 7️⃣ Remove Bold (097a512 - 16:24)
**Input:** "tira bold. bold no titulo so. ou, h2."
**Output:** Removed font-weight:bold from all nodes (H2 stays bold by default)

---

## Key Decisions Made

1. **Librarian = Servitor** (bounded, limited), Claw = Familiar (coordinator)
2. **Hard stop on missing metadata** - honesty > helpful lies
3. **Confidence threshold = 75%** (balance interruptions vs errors)
4. **User-facing errors use quotes** - what user sees
5. **Blueprint sanity checks** - familiar reviews before execution

## Artifacts Generated
- 7 diagram screenshots (stop motion evolution)
- 2 videos (1 fps + 0.5 fps)
- Retroactive screenshot script
- Watch-diagrams.sh (screencapture based)

---

## Session Stats
- **Duration:** ~2 hours (15:24 → 16:24)
- **Commits:** 7 diagram iterations
- **Infrastructure commits:** 4
- **Total commits:** 11
- **Messages exchanged:** ~40+
- **Decisions documented:** 7 major
